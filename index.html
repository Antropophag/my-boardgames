<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Play with me</title>

<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">

<!-- Wonder Unit Sans через CDN -->
<link href="https://fonts.cdnfonts.com/css/wonder-unit-sans" rel="stylesheet">

<!-- Foundation Icons 3 -->
<link rel="stylesheet" href="fonts/foundation-icons.css">

<style>
body, html {
  margin: 0; padding: 0;
  background: #111;
  font-family: 'Wonder Unit Sans', sans-serif;
  color: #fff;
}
h2.section-title {
  text-align: center;
  font-size: 28px;
  margin: 30px 0 20px;
}
.mosaic {
  width: 100%;
}
.game {
  position: relative;
  overflow: hidden;
  opacity: 0;
  transform: translateY(20px);
  transition: opacity 0.5s ease, transform 0.5s ease;
}
.game.show {
  opacity: 1;
  transform: translateY(0);
  animation: popIn 0.4s ease;
}
@keyframes popIn {
  0%   { transform: translateY(20px); }
  60%  { transform: translateY(-5px); }
  100% { transform: translateY(0); }
}
.game img {
  width: 100%;
  display: block;
  vertical-align: bottom;
  transition: transform .3s ease;
}
.game:hover img { transform: scale(1.05); }

.overlay {
  position: absolute;
  left: 0; right: 0; bottom: 0;
  background: rgba(0,0,0,0.8);
  color: #fff;
  font-weight: bold;
  padding: 8px;
  opacity: 0;
  transition: opacity 0.3s ease;
}
.game:hover .overlay { opacity: 1; }

.overlay-content {
  display: flex;
  align-items: center;
  margin-bottom: 4px;
}

.rating-hex {
  width: 40px;
  aspect-ratio: 1.15;
  background-color: gray;
  clip-path: polygon(25% 0%, 75% 0%, 100% 50%, 75% 100%, 25% 100%, 0% 50%);
  display: flex;
  justify-content: center;
  align-items: center;
  font-weight: bold;
  color: #fff;
  margin-right: 8px;
  flex-shrink: 0;
}

.title-rank {
  display: flex;
  justify-content: space-between;
  flex: 1;
  align-items: center;
}
.title-rank .title a {
  color: white;
  text-decoration: none;
  font-size: 14px;
}
.title-rank .title a:hover {
  text-decoration: underline;
  text-decoration-style: dotted;
  text-decoration-color: white;
}
.title-rank .rank {
  display: flex;
  align-items: center;
  gap: 4px;
  font-family: 'Wonder Unit Sans', sans-serif;
  font-weight: bold;
  font-size: 14px;
  color: white;
}
.title-rank .rank i {
  color: #e64900;
  font-size: 14px;
}

/* Мобильные иконки в строку, выравнивание по ширине */
.overlay .info {
  display: flex;
  justify-content: space-between; /* равные отступы */
  font-weight: bold;
  font-size: 13px;
  color: #fff;
}
.overlay .info p {
  flex: 1;
  min-width: 0;
  display: flex;
  align-items: center;
  gap: 4px;
  white-space: nowrap;
  margin: 0;
  font-weight: bold;
}
.overlay .info i {
  font-size: 16px;
}

/* Десктопная колонка с надписями под друг другом */
.info-column { 
  display: none; 
  font-weight: bold; 
  font-size: 13px; 
  color: #fff; 
}
.info-column p {
  margin: 2px 0;
  line-height: 1.2;
}

#loader {
  position: fixed; top:0; left:0; width:100%; height:100%;
  background:#111; display:flex; justify-content:center; align-items:center;
  z-index:9999;
}
.loader-circle {
  width:50px; height:50px;
  border:5px solid #333;
  border-top:5px solid #00FF00;
  border-radius:50%;
  animation: spin 1s linear infinite;
}
@keyframes spin { 0%{transform:rotate(0deg);} 100%{transform:rotate(360deg);} }

@media (max-width: 800px) {
  .game img { width: 100%; height: auto; }
  .info-column { display: none; }
}
@media (min-width: 801px) {
  .overlay .info { display: none; }
  .info-column { display: block; }
}
</style>
</head>
<body>

<div id="loader"><div class="loader-circle"></div></div>

<div id="ownMosaic" class="mosaic"></div>
<h2 class="section-title">Pre-ordered</h2>
<div id="preMosaic" class="mosaic"></div>
<h2 class="section-title">Wishlist</h2>
<div id="wishMosaic" class="mosaic"></div>

<script src="https://unpkg.com/imagesloaded@4/imagesloaded.pkgd.min.js"></script>
<script src="https://unpkg.com/masonry-layout@4/dist/masonry.pkgd.min.js"></script>
<script>
function getColumnCount() {
  if (window.innerWidth < 600) return 2;
  if (window.innerWidth < 900) return 3;
  if (window.innerWidth < 1200) return 4;
  return 5;
}

function updateColumns(container) {
  const colWidth = container.clientWidth / getColumnCount();
  container.querySelectorAll('.game').forEach(el => el.style.width = colWidth + 'px');
  return colWidth;
}

function getRatingColor(avg) {
  if(avg >= 8) return '#186b40';       
  if(avg >= 7) return '#1978b3';       
  if(avg >= 5) return '#5369a2';       
  return '#666e75';                     
}

function createGameDiv(game) {
  const div = document.createElement('div');
  div.className = 'game';

  const ratingColor = getRatingColor(game.average);
  let weightColor = '#5bda98';
  if(game.averageweight > 4) weightColor = '#df4751';
  else if(game.averageweight > 3) weightColor = '#ff6b26';

  const rank = game.overallrank ?? '—';

  div.innerHTML = `
    <img src="${game.image}" alt="${game.name}">
    <div class="overlay">
      <div class="overlay-content">
        <div class="rating-hex" style="background-color:${ratingColor}">${game.average.toFixed(1)}</div>
        <div class="title-rank">
          <div class="title"><a href="${game.url}" target="_blank">${game.name}</a></div>
          <div class="rank"><i class="fi-crown"></i> ${rank}</div>
        </div>
      </div>
      <div class="info">
        <p><i class="fi-torso"></i> ${game.minplayers}–${game.maxplayers}</p>
        <p><i class="fi-clock"></i> ${game.playingtime} min</p>
        <p><i class="fi-puzzle"></i> <span style="color:${weightColor}">${game.averageweight !== null ? game.averageweight.toFixed(2) : 'N/A'}</span>/5</p>
      </div>
      <div class="info-column">
        <p>Players: ${game.minplayers}–${game.maxplayers}</p>
        <p>Playing time: ${game.playingtime} min</p>
        <p>Complexity: <span style="color:${weightColor}">${game.averageweight !== null ? game.averageweight.toFixed(2) : 'N/A'}</span>/5</p>
      </div>
    </div>
  `;
  return div;
}

function loadGames(file, containerId) {
  const container = document.getElementById(containerId);
  fetch(file)
    .then(res => res.json())
    .then(data => {
      let games = data[containerId === 'ownMosaic' ? 'own' : containerId === 'preMosaic' ? 'preordered' : 'wishlist'];
      
      games.forEach((game, index) => {
        const div = createGameDiv(game);
        container.appendChild(div);
      });

      imagesLoaded(container, () => {
        const colWidth = updateColumns(container);
        const msnry = new Masonry(container, {
          itemSelector: '.game',
          columnWidth: colWidth,
          gutter: 0,
          percentPosition: false,
          transitionDuration: '0.4s'
        });

        container.querySelectorAll('.game').forEach((el, i) => {
          setTimeout(() => el.classList.add('show'), 100*i);
        });

        setTimeout(() => { document.getElementById('loader').style.display = 'none'; }, 3000);

        window.addEventListener('resize', () => {
          const newColWidth = container.clientWidth / getColumnCount();
          container.querySelectorAll('.game').forEach(el => el.style.width = newColWidth + 'px');
          msnry.options.columnWidth = newColWidth;
          msnry.layout();
        });
      });
    });
}

loadGames('data/games.json', 'ownMosaic');
loadGames('data/games.json', 'preMosaic');
loadGames('data/games.json', 'wishMosaic');
</script>

</body>
</html>

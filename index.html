<!DOCTYPE html>
<html lang="ru">
<head>
<link rel="icon" href="favicon.png" type="image/png">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Play with me</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
<style>
body { font-family: 'Roboto', sans-serif; background:#111; color:#fff; margin:0; padding:20px; }
h2.section-title { text-align:center; font-size:28px; margin:30px 0 20px; }

.mosaic { width:100%; margin-bottom:40px; display:flex; flex-wrap:wrap; transition: all 0.3s ease; }
.grid-sizer, .game { transition: width 0.3s ease; }
.game { position:relative; overflow:hidden; margin:0; }
.game img { width:100%; display:block; transition:transform .28s ease; }
.game:hover img { transform:scale(1.05); }

.overlay {
  position:absolute; left:0; right:0; bottom:0;
  height:calc(4 * 1.2em + 20px); /* 4 строки текста */
  background:rgba(0,0,0,0.72);
  color:#fff;
  display:flex; flex-direction:column;
  justify-content:flex-start; align-items:flex-start;
  text-align:left;
  padding:10px;
  opacity:0;
  transition:opacity .18s ease;
  font-weight: bold; /* весь текст жирный */
}
.game:hover .overlay { opacity:1; }

.overlay h3 { margin:0 0 6px; font-size:14px; line-height:1.1; }
.overlay p { margin:2px 0; font-size:12px; }

/* Лоадскрин */
#loader {
  position:fixed; top:0; left:0; width:100%; height:100%;
  background:#111; color:#fff; display:flex;
  align-items:center; justify-content:center; font-size:24px; z-index:9999;
}
</style>
</head>
<body>

<!-- Лоадскрин -->
<div id="loader">Загрузка...</div>

<!-- Collection без заголовка -->
<div id="ownMosaic" class="mosaic">
  <div class="grid-sizer"></div>
</div>

<h2 class="section-title">Preordered</h2>
<div id="preMosaic" class="mosaic">
  <div class="grid-sizer"></div>
</div>

<h2 class="section-title">Wishlist</h2>
<div id="wishMosaic" class="mosaic">
  <div class="grid-sizer"></div>
</div>
  
<script src="https://unpkg.com/imagesloaded@4/imagesloaded.pkgd.min.js"></script>
<script src="https://unpkg.com/masonry-layout@4/dist/masonry.pkgd.min.js"></script>
<script>
function getColumns(width) {
  if(width < 900) return 2;
  else if(width < 1200) return 4;
  else return 5;
}

function loadGames(file, containerId) {
  const container = document.getElementById(containerId);
  const width = container.clientWidth;
  const cols = getColumns(width);
  const colWidth = width / cols;

  fetch(file)
    .then(res => res.json())
    .then(data => {
      const games = data[containerId==='ownMosaic'?'own':(containerId==='preMosaic'?'preordered':'wishlist')];

      games.forEach(game => {
        const div = document.createElement('div');
        div.className = 'game';
        div.style.width = colWidth + 'px'; // сразу ставим ширину

        // Определяем цвет сложности
        let weightColor = '#00FF00'; // ярко-зелёный
        if(game.averageweight > 3.5) weightColor = 'red';
        else if(game.averageweight > 2) weightColor = 'orange';

        div.innerHTML = `
          <img src="${game.image}" alt="${game.name}">
          <div class="overlay">
            <h3>${game.name}</h3>
            <p>Игроки: ${game.minplayers}–${game.maxplayers}</p>
            <p>Время: ${game.playingtime} мин</p>
            <p>Рейтинг: ${game.average.toFixed(2)}</p>
            <p>Сложность: <span style="color:${weightColor}">${game.averageweight !== null ? game.averageweight.toFixed(2) : 'N/A'}</span> / 5</p>
          </div>
        `;
        container.appendChild(div);
      });

      // ждем полной загрузки изображений
      imagesLoaded(container, () => {
        const msnry = new Masonry(container, { itemSelector: '.game', columnWidth: '.grid-sizer', gutter: 0, percentPosition: false });

        // скрываем лоадскрин после загрузки
        document.getElementById('loader').style.display = 'none';

        // плавная перестройка при ресайзе
        window.addEventListener('resize', () => {
          const width = container.clientWidth;
          const cols = getColumns(width);
          const colWidth = width / cols;
          container.querySelectorAll('.grid-sizer, .game').forEach(el => { el.style.width = colWidth + 'px'; });
          msnry.layout();
        });
      });
    });
}

// загружаем данные
loadGames('data/games.json', 'ownMosaic');
loadGames('data/games.json', 'preMosaic');
loadGames('data/games.json', 'wishMosaic');
</script>

</body>
</html>

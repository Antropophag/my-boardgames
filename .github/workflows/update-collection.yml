name: Update BGG collection

on:
  workflow_dispatch:   # ручной запуск
  schedule:
    - cron: '0 12 * * *'  # ежедневный запуск в 12:00 UTC (по желанию)

jobs:
  update:
    runs-on: ubuntu-latest

    steps:
      # 1️⃣ Забираем репозиторий
      - name: Checkout repository
        uses: actions/checkout@v3

      # 2️⃣ Настраиваем Python
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.x'

      # 3️⃣ Устанавливаем зависимости
      - name: Install dependencies
        run: pip install requests

      # 4️⃣ Запускаем скрипт для скачивания коллекции
      - name: Fetch BGG collection
        run: |
          python scripts/fetch_bgg_collection.py --username "Antropophag" --out data/games.json

      # 5️⃣ Debug: проверка, что токен доступен
      - name: Debug GH_TOKEN
        env:
          GH_TOKEN: ${{ secrets.GH_TOKEN }}
        run: |
          if [ -z "$GH_TOKEN" ]; then
            echo "GH_TOKEN is EMPTY!"
            exit 1
          else
            echo "GH_TOKEN is available, length: ${#GH_TOKEN}"
